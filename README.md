# Prediction of infection by CPV

Some chemical treatment make it impossible to keep a viral marker when imaging cell infected by Canine Parvovirus (CPV). Instead, it is required to rely on other indirect observation to assume if the cell is infected. One of these observation is to check the DNA compaction that happen during the infection.

This repositery gives a couple of tools to researchers in order to predict if a cell is infected using a simple convoluted neural network (CNN) model by observing the nuclear stain.

## Training
The python script [CNN Training for Infection CPV.py](https://github.com/leclercsimon74/Infection_Prediction_CPV/blob/main/CNN%20Training%20for%20Infection%20CPV.py) can train a simple structure assuming 3 scenarios:
- Cell are infected
- Cell are not infected
- Cell are out of focus/blurry

For that, PNG images, cropped around the nuclei, one nuclei/cell, DNA/DAPI channel only and of size 100x100 pixels are required as input. These kind of images can be generated by another python script or ImageJ macro (not included in this repositery). They should be present in 3 folders, representing the 3 conditions.  
A simple data augmentation procedure is included in the script (rotation and flip).  
Training is possible on CPU and GPU, but GPU is recommended to save time.  
It is also possible to run the code in a Notebook or Google Colab [ML_for_infection_discrimination_v1_1.ipynb](https://github.com/leclercsimon74/Infection_Prediction_CPV/blob/main/ML_for_infection_discrimination_v1_1.ipynb). 

The provided model reached a 93% accurancy on the validation.  
![accuracy](https://github.com/leclercsimon74/Infection_Prediction_CPV/blob/main/accuracy_history.png)  
![loss](https://github.com/leclercsimon74/Infection_Prediction_CPV/blob/main/loss_history.png)  

## Prediction
The python script [Prediction of Infection CPV.py](https://github.com/leclercsimon74/Infection_Prediction_CPV/blob/main/Prediction%20of%20Infection%20CPV.py) can predict a whole folder of images (TIFF) in the same shape than the training, and output a CSV table with the different probabilities.  
It is also possible to run the code in a Notebook or Google Colab [Prediction_of_infection_by_ML_v1_1.ipynb](https://github.com/leclercsimon74/Infection_Prediction_CPV/blob/main/Prediction_of_infection_by_ML_v1_1.ipynb).   
Evaluation/Prediction can be run on either CPU/GPU.  

![Prediction result](https://github.com/leclercsimon74/Infection_Prediction_CPV/blob/main/data/Images/Prediction_results.png)

## Data
You can found some nuclei data for both [training](https://github.com/leclercsimon74/Infection_Prediction_CPV/tree/main/data/Training) or for [prediction](https://github.com/leclercsimon74/Infection_Prediction_CPV/tree/main/data/Images).  
A [model](https://github.com/leclercsimon74/Infection_Prediction_CPV/tree/main/data/Model) is also added!

The training dataset is composed of roughly 700 images, with a slight bias towards the noninfected condition.  

## Publication

If you happen to use these scripts, please cite the following:

    Not published yet
